<main>

    <div class="options" *ngIf=" share.options ">

        <div class="date container-fluid" *ngIf=" past ">

            <div class="row">
                <div class="begin col">
                    <mat-form-field appearance="outline"  (click)="dpStart.open()">
                        <mat-label>{{ 'DATE_BEGIN' | t}}</mat-label>
                        <input name="date" [(ngModel)]="date_begin" matInput 
                              [matDatepicker]="dpStart"
                              (dateChange)="onChangeSearchOption()"
                        >
                        <mat-datepicker #dpStart touchUi="true" disabled="false"></mat-datepicker>
                    </mat-form-field>
                </div>

                <div class="end col">
                        <mat-form-field appearance="outline"  (click)="dpEnd.open()">
                            <mat-label>{{ 'DATE_END' | t}}</mat-label>
                            <input name="date" [(ngModel)]="date_end" matInput 
                                    [matDatepicker]="dpEnd"
                                    (dateChange)="onChangeSearchOption()"
                            >
                            <mat-datepicker #dpEnd touchUi="true" disabled="false"></mat-datepicker>
                        </mat-form-field>
                </div>
            </div>

        </div>

        <div class="teachers container-fluid" *ngIf=" my_teachers ">
            <div class="row">
                <div class="col">
                        <mat-form-field appearance="outline">
                            <mat-label>{{ 'SELECT_TEACHER'| t }}</mat-label>
                            <mat-select [(ngModel)]="show_teacher" (selectionChange)="onChangeSearchOption()">
                                <mat-option *ngFor="let teacher of teachers_keys" [value]="teacher">
                                        {{ my_teachers[teacher].name }}
                                </mat-option>
                                <mat-option [value]="0">
                                        {{ "ALL_TEACHER" | t}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                </div>
            </div>
        </div>

        <div class="checkbox-list" *ngIf=" past ">
            <label>
                <input type="checkbox" [(ngModel)]="show_refund_in_progress" color="vibrant"
                              (change)="onChangeSearchOption()"/>
                <span>{{ 'DISPLAY_SESSION_IN_PROGRESS' | t}}</span>
            </label>

            <label>
                <input type="checkbox" [(ngModel)]="show_refunded" color="vibrant"
                              (change)="onChangeSearchOption()"/>
                <span>{{ 'DISPLAY_REFUNDED_SESSION' | t}}</span>
            </label>

            <ng-container *ngIf="a.isStudent">
                <label>
                    <input type="checkbox" [(ngModel)]="displayTeacherName" color="vibrant"/>
                    <span>{{ 'SHOW_TEACHER_NAME'| t }}</span>
                </label>

                <label>
                    <input type="checkbox" [(ngModel)]="displayDate" color="vibrant"/>
                    <span>{{ 'DISPLAY_DATE' | t }}</span>
                </label>
                
                <label>
                    <input type="checkbox" [(ngModel)]="displayPoint" color="vibrant"/>
                    <span>{{ 'POINT_MARK' | t}}</span>
                </label>
            </ng-container>
        </div>

        <div class="close" >
            <button (click)=" share.options = false ">
                {{ 'CLOSE' | t}}
            </button>
        </div>

        <hr>
    </div>
    <!--/options-->

    <div class="teacher-warning" *ngIf=" a.isTeacher ">
        Teacher must see this page in wide screen since the content in this page is wide.
    </div>

    <div  class="stats-table" *ngIf=" re && books.length ">
            <table>
                <tr>
                    <td>{{ 'SEARCHED_SESSIONS' | t }}</td>
                    <td>{{ books.length }} ( {{ 'TOTAL' | t }} : {{ re.total_sessions }} )</td>
                </tr>
                <tr *ngIf=" a.isTeacher ">
                    <td>{{ 'SEARCHED_POINT' | t }}</td>
                    <td>{{ re.total_points | number }}</td>
                </tr>
                <tr *ngIf=" past ">
                    <td>{{ 'REFUNDED_SESSIONS' | t}}</td>
                    <td>{{re.total_session_refunded}}</td>
                </tr>
                <tr *ngIf=" re.total_session_refund_in_progress ">
                    <td>{{ 'SESSIONS_IN_REFUND_PROGRESS' | t}}</td>
                    <td>{{re.total_session_refund_in_progress}}</td>
                </tr>
                <tr>
                    <td>{{ 'SEARCH_PERIOD' | t}}</td>
                    <td>{{ date_begin }} ~  {{ date_end }}</td>
                </tr>
                <tr  *ngIf="a.userTime" routerLink="/settings">
                    <td>{{ 'TIMEZONE NOW' | t}}</td>
                    <td>
                        {{ a.userTime }}
                        <span class="change-timezone"> {{ 'CHANGE TIMEZONE' | t }}</span>
                    </td>
                </tr>
            </table>
    </div>


    <div class="no-more" *ngIf=" re && books.length == 0 ">
        <ng-container *ngIf=" future ">{{ 'NO_MORE_RESERVATIONS' | t}}</ng-container>
        <ng-container *ngIf=" past ">{{ 'NO_MORE_PASTS' | t}}</ng-container>
    </div>

    <div class="loader" *ngIf=" loadingOnSearch  ">
        <mat-spinner [diameter]="48"></mat-spinner>
        <span>{{ 'IN LOADING' | t}}</span>
    </div>

    <div *ngIf=" books.length ">
        <div class="container-fluid">

            <div class="header-student row"  *ngIf="a.isStudent">
                <div class="col-3 col-md-1" *ngIf="a.isStudent">
                    <div>{{ 'TEACHER' | t}}</div>
                </div>
                <div class="col-3 col-md-2" *ngIf="a.isTeacher">
                    <div>{{ 'STUDENT' | t}}</div>
                </div>
                <div class="col-2 col-md-1" *ngIf="a.isTeacher">
                    <div>{{ 'CLASS NO' | t}}</div>
                </div>
                <div class="col-2 col-md-1" *ngIf="displayDate">
                    <div>{{ 'DATE' | t}}</div>
                </div>
                <div class="col-2 col-md-1">
                    <div>{{ 'TIME' | t}}</div>
                </div>
                <div class="col-1 col-md-1">
                    <div>{{ 'minute short' | t}}</div>
                </div>
                <div class="col-2 col-md-2" *ngIf=" future ">
                    <div>
                        {{ a.ln.ADD_KAKAOTALK }}
                    </div>
                </div>
                <div class="col-2 col-md-1" *ngIf="displayPoint">
                    <div>{{ 'POINT' | t}}</div>
                </div>
                <div class="sm-hide col-2 col-md-3">
                    <ng-container *ngIf=" a.isStudent && past ">
                        <div> {{ 'RESULT' | t}}</div>
                    </ng-container>
                </div>
            </div>

            <div class="header-teacher row" *ngIf="a.isTeacher">
                <div class="col-3 col-md-1" *ngIf="a.isStudent">
                    <div>{{ 'TEACHER' | t}}</div>
                </div>
                <div class="col-3 col-md-2" *ngIf="a.isTeacher">
                    <div>{{ 'STUDENT' | t}}</div>
                </div>
                <div class="col-2 col-md-1" *ngIf="a.isTeacher">
                    <div>{{ 'CLASS NO' | t}}</div>
                </div>
                <div class="col-2 col-md-1" *ngIf="displayDate">
                    <div>{{ 'DATE' | t}}</div>
                </div>
                <div class="col-2 col-md-1">
                    <div>{{ 'TIME' | t}}</div>
                </div>
                <div class="col-1 col-md-1">
                    <div>{{ 'minute short' | t}}</div>
                </div>
                <div class="col-2 col-md-2" *ngIf=" future ">
                    <div>
                        {{ a.ln.ADD_KAKAOTALK }}
                    </div>
                </div>
                <div class="col-2 col-md-1" *ngIf="displayPoint">
                    <div>{{ 'POINT' | t}}</div>
                </div>
                <div class="sm-hide col-2 col-md-3">
                    <ng-container *ngIf=" a.isStudent && past ">
                        <div> {{ 'RESULT' | t}}</div>
                    </ng-container>
                </div>
            </div>

            <div class="data row" *ngFor="let book of books; let i = index; let o = odd; let e = even">
                <div class="col-3 col-md-1" *ngIf="a.isStudent">
                    <section class="teacher-photo">
                        <a class="photo"
                             routerLink="/schedule-table" [queryParams]="{ idx_teacher: book.idx_teacher }">
                            <img src="{{ photoURL( book )  }}">
                        </a>
                        <div class="photo-name" *ngIf="displayTeacherName">
                            {{ a.preTeacherName(my_teachers[book.idx_teacher].name) }}
                        </div>
                    </section>
                </div>
                <div class="col-3 col-md-2" *ngIf="a.isTeacher">
                    <div> {{ a.preTeacherName(book.student_name) }}</div>
                </div>
                <div class="col-2 col-md-1" *ngIf=" a.isTeacher ">
                    <div>{{book.idx}}</div>
                </div>
                <div class="col-2 col-md-1" *ngIf="displayDate">
                    <div>{{ date(book.date_display) }}</div>
                </div>
                <div class="col-2 col-md-1">
                    <div>{{book.class_begin_display}}</div>
                </div>
                <div class="col-1 col-md-1">
                    <div>{{book.duration}}</div>
                </div>
                <div class="col-2 col-md-2" *ngIf=" future ">
                    <div class="kakaotalk-id">
                        <ng-container *ngIf="a.isTeacher">
                            {{book.student_kakaotalk_id}}
                        </ng-container>
                        <ng-container *ngIf="a.isStudent">
                            <div>
                                {{ my_teachers[book.idx_teacher].kakaotalk_id }}
                            </div>

                        </ng-container>
                    </div>
                </div>
                <div class="col-2 col-md-1" *ngIf="displayPoint">
                    <div class="point"> {{ point(book) }}</div>
                </div>
                <div class="col-12 col-md-3">
                    <div class="buttons-wrapper container-fluid">
                        <div class="row">
                            <ng-container *ngIf=" book.past ">
                                <ng-container *ngIf=" a.isTeacher ">
                                    <div class="col-6" *ngIf=" !paid(book) && !refunded( book ) ">
                                        <button class="evaluate" *ngIf=" ! evaluated(book) "
                                                (click)=" a.open('teacher-session-evaluate', {idx: book.idx}) ">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>
                                            {{ 'EVALUATE' | t}}
                                        </button>
                                        <button class="evaluated" *ngIf="  evaluated(book) "
                                                (click)=" a.open('teacher-session-evaluate', {idx: book.idx}) ">
                                            {{ 'EVALUATED' | t}}
                                        </button>
                                    </div>
                                    <div class="col-6" *ngIf=" refundable(book) ">
                                        <button class="refundable" (click)=" onClickRefund( book ) ">{{ 'REFUND' | t}}</button>
                                    </div>
                                    <div class="col-6" *ngIf=" paid(book) ">
                                        <span>{{ 'PAID' | t}}</span>
                                    </div>
                                    <div class="col-6" *ngIf=" refunded( book ) ">
                                        <span class="refunded">{{ 'REFUNDED' | t }}</span>
                                    </div>
                                    <div class="col-6" *ngIf=" refund_in_progress(book) ">
                                        <div>
                                            <button class="rejected" *ngIf=" rejected(book); else Requested "
                                                  (click)=" a.open( 'session-refund-reject', {idx: book.idx} )">
                                                {{ 'REJECTED' | t }}
                                            </button>
                                            <ng-template #Requested>
                                                <button class="refund-requested" (click)=" a.open('session-refund-review', {idx: book.idx}) ">
                                                    {{ 'REFUND_REQUESTED' | t }}
                                                </button>
                                            </ng-template>
                                        </div>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf=" a.isStudent ">
                                    <div class="col-6" *ngIf=" !refunded(book) ">
                                        <button class="evaluate-view" (click)=" a.open('session-evaluation', {idx: book.idx} ) ">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM96 424c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm96-192c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm128 368c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"/></svg>
                                            {{ 'LECTURE_EVALUATION' | t }}
                                        </button>
                                    </div>
                                    <div class="col-6" *ngIf=" !refund_in_progress(book) ">
                                        <button class="comment-create" (click)=" a.open('teacher-review-create', {idx_teacher: book.idx_teacher} ) ">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"/></svg>
                                            {{ 'WRITE_A_REVIEW' | t }}
                                        </button>
                                    </div>
                                    <div class="col-6" *ngIf=" rejected( book ) " (click)="a.open( 'session-refund-reject', {idx: book.idx} )">
                                        <button class="point-refund-rejected"> {{ 'POINT_REFUND_REJECTED' | t }}</button>
                                    </div>
                                    <div class="col-6" *ngIf=" refunded(book) ">
                                        <span class="refunded"> {{ 'REFUNDED' | t }}</span>
                                    </div>
                                    <div class="col-6" *ngIf=" ! book.refund_timeover && ! rejected( book )">
                                        <ng-container *ngIf=" ! refunded( book ) ">
                                            <button class="cancel-refund-request" (click)=" onClickCancelRefundRequest( book )"
                                                    *ngIf="book.refund_request_at > 0 ">
                                                    {{ "CANCEL_REFUND_REQUEST" | t }}
                                  
                                            </button>
                                            <button class="request-refund" (click)=" a.open( 'session-refund-request', {idx: book.idx} )"
                                                    *ngIf=" book.refund_request_at == 0">
                                                <span class="spin" *ngIf="loadingRefundRequest">
                                                    <mat-spinner [diameter]="20"></mat-spinner>
                                                </span>
                                                {{ "REQUEST_REFUND" | t }}
                                            </button>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </div>

                        <div class="row" *ngIf=" future  ">
                            <div class="col-6">
                                <button class="cancel" *ngIf=" ! book.process  " (click)="onClickCancel( book )">
                                    <svg class="button-icon" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M217.5 256l137.2-137.2c4.7-4.7 4.7-12.3 0-17l-8.5-8.5c-4.7-4.7-12.3-4.7-17 0L192 230.5 54.8 93.4c-4.7-4.7-12.3-4.7-17 0l-8.5 8.5c-4.7 4.7-4.7 12.3 0 17L166.5 256 29.4 393.2c-4.7 4.7-4.7 12.3 0 17l8.5 8.5c4.7 4.7 12.3 4.7 17 0L192 281.5l137.2 137.2c4.7 4.7 12.3 4.7 17 0l8.5-8.5c4.7-4.7 4.7-12.3 0-17L217.5 256z"></path></svg>
                                    <div>{{ 'CANCEL' | t}}</div>
                                </button>
                                <span *ngIf="  book.process">
                                    <svg class="button-icon spin" aria-hidden="true" data-prefix="fal" data-icon="spinner" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M288 32c0 17.673-14.327 32-32 32s-32-14.327-32-32 14.327-32 32-32 32 14.327 32 32zm-32 416c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32zm256-192c0-17.673-14.327-32-32-32s-32 14.327-32 32 14.327 32 32 32 32-14.327 32-32zm-448 0c0-17.673-14.327-32-32-32S0 238.327 0 256s14.327 32 32 32 32-14.327 32-32zm33.608 126.392c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32zm316.784 0c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32zM97.608 65.608c-17.673 0-32 14.327-32 32 0 17.673 14.327 32 32 32s32-14.327 32-32c0-17.673-14.327-32-32-32z"></path></svg>
                                </span>
                            </div>
                            <div class="col-6" *ngIf=" a.isTeacher ">
                                <button [ngClass]=" book.stamp_checked != 0 ? 'ready-confirmed' : 'ready-not-confirmed' " (click)="onClickReady( book )">
                                    <span *ngIf=" book.ready ">
                                        <svg class="button-icon spin" aria-hidden="true" data-prefix="fal" data-icon="spinner" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M288 32c0 17.673-14.327 32-32 32s-32-14.327-32-32 14.327-32 32-32 32 14.327 32 32zm-32 416c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32zm256-192c0-17.673-14.327-32-32-32s-32 14.327-32 32 14.327 32 32 32 32-14.327 32-32zm-448 0c0-17.673-14.327-32-32-32S0 238.327 0 256s14.327 32 32 32 32-14.327 32-32zm33.608 126.392c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32zm316.784 0c-17.673 0-32 14.327-32 32s14.327 32 32 32 32-14.327 32-32-14.327-32-32-32zM97.608 65.608c-17.673 0-32 14.327-32 32 0 17.673 14.327 32 32 32s32-14.327 32-32c0-17.673-14.327-32-32-32z"></path></svg>
                                    </span>
                                    <span>{{ 'READY' | t }}</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/books-->


    <div class="legends container-fluid" *ngIf=" a.isTeacher ">
        <div class="row">
            <div class="col">
                <div>
                    <div>Total Points from payable sessions</div>
                    <div>
                        {{teacher_summary['total_points_from_payable_session']}}
                    </div>
                </div>
                <div>
                    <div>Your Total Share Points</div>
                    <div>
                        {{teacher_summary['total_teacher_share_points']}}
                    </div>
                </div>
                <div>
                    <div>No. of payable sessions</div>
                    <div>
                        {{teacher_summary['counts_of_payable_session']}}
                    </div>
                </div>
                <div>
                    <div>No. of not Payable sessions</div>
                    <div>
                        {{teacher_summary['counts_of_not_payable_session']}}
                    </div>
                </div>
                <div>
                    <div>Session not evaluated. <span>*No pay</span>.</div>
                    <div class="eval">Eval</div>
                </div>

                <div>
                    <div>Session you confirmed.</div>
                    <div class="ready-confirmed">Ready</div>
                </div>
                <div>
                    <div>Session you must confirm.</div>
                    <div class="ready-not-confirmed">Ready</div>
                </div>
            </div>
            <div class="col">
                <div>
                    <div>No. of paid sessions</div>
                    <div>
                        {{teacher_summary['counts_of_paid_session']}}
                    </div>
                </div>
                <div>
                    <div>No. of refunded sessions</div>
                    <div>
                        {{teacher_summary['counts_of_refunded_session']}}
                    </div>
                </div>
                <div>
                    <div>No. of refund in progress</div>
                    <div>
                        {{teacher_summary['counts_of_rejected_refund'] + teacher_summary['counts_of_requested_refund']}}
                    </div>
                </div>
                <div>
                    <div>No. of Incomplete Evaluation</div>
                    <div>
                        {{teacher_summary['counts_of_incomplete_eval']}}
                    </div>
                </div>
                <div>
                    <div>Point Refund Request Rejected.</div>
                    <div class="rejected">Rejected</div>
                </div>
                <div>
                    <div>Accept Refund Request</div>
                    <div class="accept">Accept</div>
                </div>
                <div>
                    <div>Reject Refund Request.</div>
                    <div class="reject">Reject</div>
                </div>
            </div>
        </div>
    </div>

</main>
